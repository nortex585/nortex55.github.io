<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zyper Drive | Fixed</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body { background-color: #0f1012; color: white; font-family: 'Segoe UI', sans-serif; }
        .glass-card { background: rgba(255, 255, 255, 0.03); border: 1px solid rgba(255, 255, 255, 0.1); backdrop-filter: blur(10px); }
        .gradient-text { background: linear-gradient(135deg, #5865f2, #00d4ff); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        /* Tıklama efektleri */
        .upload-area:active { transform: scale(0.98); }
    </style>
</head>
<body class="p-4 md:p-10">

    <div class="max-w-4xl mx-auto">
        <header class="text-center mb-10">
            <h1 class="text-5xl font-extrabold gradient-text mb-2">ZYPER DRIVE</h1>
            <p class="text-gray-400 font-medium">Güvenli ve Hızlı Dosya Paylaşımı</p>
        </header>

        <div class="glass-card p-8 rounded-3xl mb-8">
            <h2 class="text-xl font-bold mb-4 flex items-center gap-2 text-blue-400">
                <i class="fa-solid fa-cloud-arrow-up"></i> Dosya Yükle
            </h2>
            
            <div class="flex flex-col gap-4">
                <input type="file" id="fileInput" class="hidden">
                
                <div onclick="document.getElementById('fileInput').click()" 
                     class="upload-area border-2 border-dashed border-zinc-700 hover:border-blue-500 hover:bg-blue-500/5 rounded-xl p-10 text-center cursor-pointer transition-all">
                    <i class="fa-solid fa-file-import text-4xl text-gray-500 mb-3"></i>
                    <p id="fileName" class="text-gray-400 font-semibold text-lg">Dosya Seçmek İçin Buraya Tıklayın</p>
                    <p class="text-xs text-gray-600 mt-2">Maksimum dosya boyutu: 100MB</p>
                </div>

                <button onclick="uploadFile()" id="uploadBtn" 
                        class="w-full bg-blue-600 hover:bg-blue-700 disabled:bg-gray-700 py-4 rounded-xl font-bold transition flex items-center justify-center gap-2 shadow-lg shadow-blue-900/20">
                    <i class="fa-solid fa-upload"></i> Sunucuya Gönder
                </button>
            </div>

            <div id="progressContainer" class="hidden mt-6">
                <div class="flex justify-between text-xs mb-2">
                    <span id="statusText">Yükleniyor...</span>
                    <span id="percentText">0%</span>
                </div>
                <div class="w-full bg-zinc-800 rounded-full h-3">
                    <div id="progressBar" class="bg-blue-500 h-3 rounded-full transition-all duration-300" style="width: 0%"></div>
                </div>
            </div>
        </div>

        <div class="glass-card p-8 rounded-3xl">
            <h2 class="text-xl font-bold mb-4 flex items-center gap-2 text-green-400">
                <i class="fa-solid fa-magnifying-glass"></i> Dosya Bul
            </h2>
            <input type="text" id="searchInput" onkeyup="searchFiles()" 
                   placeholder="Dosya ismini yazın..." 
                   class="w-full bg-zinc-900 border border-zinc-700 p-4 rounded-xl outline-none focus:ring-2 ring-green-500 transition mb-6">

            <div id="fileList" class="space-y-3">
                </div>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-storage-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-database-compat.js"></script>

    <script>
        // ÖNEMLİ: Firebase bilgilerin buraya gelecek!
        const firebaseConfig = {
            apiKey: "AIza...",
            authDomain: "projen.firebaseapp.com",
            databaseURL: "https://projen.firebaseio.com",
            projectId: "projen",
            storageBucket: "projen.appspot.com",
            appId: "1:..."
        };
        firebase.initializeApp(firebaseConfig);
        const storage = firebase.storage();
        const database = firebase.database();

        const fileInput = document.getElementById('fileInput');
        const fileNameDisp = document.getElementById('fileName');

        // DOSYA SEÇİLDİĞİNDE TETİKLENİR
        fileInput.addEventListener('change', function() {
            if (this.files && this.files.length > 0) {
                const name = this.files[0].name;
                fileNameDisp.innerText = "Seçilen: " + name;
                fileNameDisp.classList.replace('text-gray-400', 'text-blue-400');
            }
        });

        function uploadFile() {
            const file = fileInput.files[0];
            if (!file) return alert("Lütfen önce bir dosya seçin!");

            const uploadBtn = document.getElementById('uploadBtn');
            const progressContainer = document.getElementById('progressContainer');
            const progressBar = document.getElementById('progressBar');
            const percentText = document.getElementById('percentText');

            uploadBtn.disabled = true;
            progressContainer.classList.remove('hidden');

            const storageRef = storage.ref('uploads/' + Date.now() + "_" + file.name);
            const uploadTask = storageRef.put(file);

            uploadTask.on('state_changed', 
                (snapshot) => {
                    const progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
                    progressBar.style.width = progress + '%';
                    percentText.innerText = Math.round(progress) + "%";
                }, 
                (error) => {
                    console.error(error);
                    alert("Hata: " + error.message);
                    uploadBtn.disabled = false;
                }, 
                () => {
                    uploadTask.snapshot.ref.getDownloadURL().then((url) => {
                        database.ref('files').push({
                            name: file.name,
                            downloadUrl: url,
                            size: (file.size / 1024).toFixed(1) + " KB",
                            date: new Date().toLocaleDateString()
                        });
                        alert("Dosya başarıyla yüklendi!");
                        location.reload();
                    });
                }
            );
        }

        function searchFiles() {
            const q = document.getElementById('searchInput').value.toLowerCase();
            const list = document.getElementById('fileList');
            if (q.length < 2) { list.innerHTML = ""; return; }

            database.ref('files').once('value', (snap) => {
                list.innerHTML = "";
                snap.forEach((child) => {
                    const data = child.val();
                    if (data.name.toLowerCase().includes(q)) {
                        list.innerHTML += `
                            <div class="flex items-center justify-between p-4 bg-zinc-900/80 border border-zinc-800 rounded-xl">
                                <div>
                                    <p class="font-bold text-white">${data.name}</p>
                                    <p class="text-xs text-gray-500">${data.size} | ${data.date}</p>
                                </div>
                                <a href="${data.downloadUrl}" target="_blank" class="bg-blue-600 px-4 py-2 rounded-lg text-xs font-bold hover:bg-blue-500 transition">İndir</a>
                            </div>`;
                    }
                });
            });
        }
    </script>
</body>
</html>
